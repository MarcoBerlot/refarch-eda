{"version":3,"sources":["webpack:///./src/pages/use-cases/kafka-mm2/lab-2/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","AnchorLinks","AnchorLink","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-use-cases-kafka-mm-2-lab-2-index-mdx-c5b7b8cddddabc60f9ed.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/refarch-eda/refarch-eda/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component '\" + name + \"' was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <AnchorLinks mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Overview</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Pre-requisites</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Start Mirror Maker 2</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Start Consumer from target cluster</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Start Producer to source cluster</AnchorLink>\n    </AnchorLinks>\n    <h2>{`Overview`}</h2>\n    <p>{`For this scenario the source cluster is an Event Streams on premise on OpenShift, and the target cluster is an Event Stream on Cloud. Mirror Maker 2 runs on OpenShift.`}</p>\n    <p>{` `}<span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"941px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"40.625%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABsElEQVQozz2Sz27TQBDG83DwArwIB56AC+LMAYn0VIkn4AQcoZVAQAkciqKmaRtSRamTeu3dtff/j7GjMtLI9rez3/fNeCZdB9YWQgDnYLc7ZF0XvD9gxkAnBV1yuBxJFJpkqYOmTx4nqYKjjY5JXUe0EUC1XF5es71TIhCELLPfK6rqfiSttUXpjqbVLBZLtlUlIj0hRXLJaBeofcekaSNDzOdzpkdHnJ39IESxJi5gOPM0OrHc1mPd7fqW6ZsppyenWLFutBFxIc0JnwMTazMlZ2IqWJfpbUffe8EiV1eZ8/OCi5HFRgldlovyLQRaa3HuUI0SzIh8xg4ta53FTEH45KLMy1p+vp/z7uUnjp/P+DVL2M6zutM8hHCO/h/iy8kwZxEqQmi6w1FIgwb8vljx8dsNn882/PlbCZK4V5Fl1Yx1RcQPydjiyu758H2Hsp5QpOV205DFfmJwmNlaePLW8Pi45dELx82yjO00vf/vaCAc4tpsefr1Nc9mr1iaDVHmODHKo1UYLQ/zbNtE28iKiOLFPLFeSyuuYGSHhrUxsZfn4X2YWS8/0PgDPqzQP/5BYGsVVJKNAAAAAElFTkSuQmCC')\",\n            \"backgroundSize\": \"cover\",\n            \"display\": \"block\"\n          }\n        }}></span>{`\n  `}<img parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-image\",\n          \"alt\": \"1\",\n          \"title\": \"1\",\n          \"src\": \"/refarch-eda/static/c741caf22e59133ebd5ca1c03f52256c/89104/mm2-lab2.png\",\n          \"srcSet\": [\"/refarch-eda/static/c741caf22e59133ebd5ca1c03f52256c/7fc1e/mm2-lab2.png 288w\", \"/refarch-eda/static/c741caf22e59133ebd5ca1c03f52256c/a5df1/mm2-lab2.png 576w\", \"/refarch-eda/static/c741caf22e59133ebd5ca1c03f52256c/89104/mm2-lab2.png 941w\"],\n          \"sizes\": \"(max-width: 941px) 100vw, 941px\",\n          \"style\": {\n            \"width\": \"100%\",\n            \"height\": \"100%\",\n            \"margin\": \"0\",\n            \"verticalAlign\": \"middle\",\n            \"position\": \"absolute\",\n            \"top\": \"0\",\n            \"left\": \"0\"\n          },\n          \"loading\": \"lazy\"\n        }}></img>{`\n    `}</span></p>\n    <ol>\n      <li parentName=\"ol\">{`Mirror Maker 2 runs on OpenShift as pod in the same namespace as Event Streams`}</li>\n      <li parentName=\"ol\">{`A producer in python to send records to `}<inlineCode parentName=\"li\">{`products`}</inlineCode>{` topic, will run locally or could be deployed on OpenShift too as a job`}</li>\n      <li parentName=\"ol\">{`Event Streams on Cloud with replicated topic and Kafdrop to see the replicated messages.`}</li>\n    </ol>\n    <h2>{`Pre-requisites`}</h2>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`We will use the Cloud shell tool, so connect and create the environment for this shell using the same instructions as in `}<a parentName=\"p\" {...{\n            \"href\": \"https://ibm-cloud-architecture.github.io/refarch-eda/use-cases/overview/pre-requisites#ibm-cloud-shell\"\n          }}>{`the schema registry lab`}</a>{`.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Login to the OpenShift cluster using the console and get the API token`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc login --token=L0.... --server=https://api.eda-solutions.gse-ocp.net:6443\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`If not done from lab 1, clone the github to get access to the Mirror Maker 2 manifests we are using:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`git clone https://github.com/ibm-cloud-architecture/refarch-eda-data-consistency\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`As Event Streams on the Cloud does not authorize to create topic with the Kafka Admin API, we need to create the following topics with scripts or GUI. The naming convention respects the name of the source cluster as defined in the MirrorMaker2 manifest we will detail later.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`es-1.products`}</inlineCode>{`   matches the partition allocated to the source topic`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`mirrormaker2-cluster-configs`}</inlineCode>{` one partition`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`mirrormaker2-cluster-offsets`}</inlineCode>{` 25 partitions`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`mirrormaker2-cluster-status`}</inlineCode>{` 5 partitions.`}</li>\n        </ul>\n      </li>\n    </ul>\n    <p>{`Use the default replication factor of 3.`}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Create a secret for the API KEY of the Event Streams on Cloud as target cluster:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`# Go to the project where Event Streams is installed\noc project integration\noc create secret generic es-oc-api-secret --from-literal=password=<replace-with-event-streams-on-cloud-apikey>\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Verify the Event Streams on OpenShift service end point URL. This URL will be used to configure Mirror Maker 2. `}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`# Use the bootstrap internal URL\noc get svc light-es-kafka-bootstrap\n# The URL is\nlight-es-kafka-bootstrap.integration.svc:9093\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Verify the CA certificate secrets:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{` oc describe secret light-es-cluster-ca-cert\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Get a user with write access to topic, group and transactions. You can use the User Interface to do so with the Create TLS credential on the internal URL panel. See `}<a parentName=\"p\" {...{\n            \"href\": \"http://localhost:8000/use-cases/overview/pre-requisites#getting-tls-authentication-from-event-streams-on-openshift\"\n          }}>{`those instructions if needed`}</a>{`.`}</p>\n      </li>\n    </ul>\n    <h2>{`Start Mirror Maker 2`}</h2>\n    <p>{`In this lab, Mirror Maker 2 will run on the same cluster as Event Streams within the same namespace (e.g. integration). `}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Define source and target cluster properties in a Mirror Maker 2 `}<inlineCode parentName=\"p\">{`es-ocp-to-es-oc.yml`}</inlineCode>{` descriptor file. There is one example of such file for the replication between Event Streams OCP to Event Streams on cloud `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/ibm-cloud-architecture/refarch-eda-data-consistency/blob/master/mirror-maker-2/es-ocp/es-ocp-to-es-oc.yml\"\n          }}>{`here: es-ocp-to-es-oc.yml`}</a>{`. We strongly recommend to study the schema definition of this `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/strimzi/strimzi-kafka-operator/blob/2d35bfcd99295bef8ee98de9d8b3c86cb33e5842/install/cluster-operator/048-Crd-kafkamirrormaker2.yaml#L648-L663\"\n          }}>{`custom resource from this page`}</a>{`. `}</p>\n        <p parentName=\"li\">{` Here are some important parameters you need to consider: The namespace needs to match the event streams project, and the annotations the product version and ID. The connectCluster needs to match the alias of the target cluster. The alias `}<inlineCode parentName=\"p\">{`es-ic`}</inlineCode>{` is defined later in this manifest:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-yaml\"\n          }}>{`apiVersion: eventstreams.ibm.com/v1alpha1\nkind: KafkaMirrorMaker2\nmetadata:\n  name: mm2\n  namespace: integration\nspec:\n  template:\n    pod:\n      metadata:\n        annotations:\n          eventstreams.production.type: CloudPakForIntegrationNonProduction\n          productCloudpakRatio: \"2:1\"\n          productChargedContainers: mm2-mirrormaker2\n          productVersion: 10.0.0\n          productID: 2a79e49111f44ec3acd89608e56138f5\n          cloudpakName: IBM Cloud Pak for Integration\n          cloudpakId: c8b82d189e7545f0892db9ef2731b90d\n          productName: IBM Event Streams for Non Production\n          cloudpakVersion: 2020.2.1\n          productMetric: VIRTUAL_PROCESSOR_CORE\n  version: 2.5.0\n  replicas: 1\n  connectCluster: \"es-ic\"\n`}</code></pre>\n        <p parentName=\"li\">{` The version matches the Kafka version we use. The number of replicas can be set to 1 to start. The `}<inlineCode parentName=\"p\">{`eventstreams.production.type`}</inlineCode>{` is needed for Event Streams.`}</p>\n        <p parentName=\"li\">{` Then the yaml defines the connection configuration for each clusters: Event Streams on cloud, so you need to define the bootstrap servers (This could come from a config map too) and the API key coming from the previously defined secret. The user is always ‘token’`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-yaml\"\n          }}>{`clusters:\n  - alias: \"es-ic\"\n    bootstrapServers: broker-0-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-1-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n    tls: {}\n    authentication:\n      passwordSecret:\n          secretName: es-oc-api-secret  \n          password: password \n      username: token\n      type: plain\n`}</code></pre>\n        <p parentName=\"li\">{` For Event Streams on premise running within OpenShift, the connection uses TLS, certificates and Sram credentials. As we run in a separate namespace the URL is the ‘external’ one.`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-yaml\"\n          }}>{`- alias: \"es-1\"\n    bootstrapServers: light-es-kafka-bootstrap.integration.svc:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n      ssl.endpoint.identification.algorithm: https\n    tls: \n      trustedCertificates:\n        - secretName: light-es-cluster-ca-cert\n          certificate: ca.crt\n    authentication:\n      type: tls\n      certificateAndKey:\n        certificate: user.crt\n        key: user.key\n        secretName: es-tls-user\n          \n`}</code></pre>\n        <p parentName=\"li\">{`Finally the `}<inlineCode parentName=\"p\">{`connectCluster`}</inlineCode>{` attribute defines the cluster alias used by MirrorMaker2 to define its hidden topics, it must match the target cluster of the replication in the list at `}<inlineCode parentName=\"p\">{`spec.clusters`}</inlineCode>{`.`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc apply -f mirror-maker-2/es-ocp/es-ocp-to-es-oc.yml\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Verify the characteristics of the Mirror Maker 2 instance using the CLI`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc describe kafkamirrormaker2 mm2\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`See the logs:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc get pods | grep mm2\noc logs mm2-mirrormaker2-...\n`}</code></pre>\n      </li>\n    </ul>\n    <h2>{`Start Consumer from target cluster`}</h2>\n    <p>{`As Mirror Maker 2 is set to replicate topics to the `}<inlineCode parentName=\"p\">{`es-ic`}</inlineCode>{` cluster which is the event streams on cloud cluster we now need to connect a consumer to see the replicated records. For that we can use Kafdrop and we need tosSpecifying the target cluster as Event Streams on cloud:`}</p>\n    <p>{`Define environment variables to connect to Event Streams on cloud`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ES_IC_BROKERS=broker-0-...\nES_IC_USER=token\nES_IC_PASSWORD=n...\nES_IC_SASL_MECHANISM=PLAIN\nES_IC_LOGIN_MODULE=org.apache.kafka.common.security.plain.PlainLoginModule\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{}}>{`./scripts/startKafdrop.sh es-ic\n`}</code></pre>\n    <p>{`Go to the es-1.products topic to see the replicated messages:`}</p>\n    <p>{` `}<span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1152px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"49.30555555555556%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACC0lEQVQoz41SyY7aQBD1T4TBHha7bYOxDcbsm8ZgFjOGDAkozCjJiVwjReIWlFwmSNwTcZqcM5/5UuUsUiJFyuGpurqrX79XXVIuHEH4U+iXAiKXgcjnoQnxJzTt3/h1rutQbQeSPN0iH91DLftQgiFy9QYEFTCxUPM/1nTpf8Ckklm04VW6cBpNWP0BzHYHmm1Dc10ItwzDLECnYp2KDcNIovg7Z9Cao1TzfVzHcwRXARZRhGqrjZTjItPpIeXX8URRkM1kkM3lkEqloFCuqiqy2SwuKE/LMrRLBVo6BU2RIRWLFkbhGC9fvUY4mWK322G9WsEpFBCFIe5ub9Fut9FsNrHdbhHRo47joNvt4gXlN8sFiuEM+rM7mNESUqlUoqI5jscjNpsNHh6+4nQ6oU/23x8O+Pb4iPV6jTiOcT6fsd/vUa/Xk9ovlN9//AD7zVsYnz6j+O4AyfaqmMxjtMjqKJxgQNar1So6nQ5apCwYjdFoNFAgxRmybppmopAj2xZCh2NQP+ULaHIakuV5GBPhcDjCmCzPrxcYDAaksI9gOMTyZpWsmaRSqcCnnnN06dMY/LhbLkOnB5JfLpHCWbxMCKdkfR4v0Ov1EvDe09XzpF+WZf0mZSKbJoFRJjI+Ez/nUSpUPATTWaLqiuaQP4gJGLw3oTNW6JETvsz9q9VqCTHnvGaVPEJM+B3RrELRlLoAZAAAAABJRU5ErkJggg==')\",\n            \"backgroundSize\": \"cover\",\n            \"display\": \"block\"\n          }\n        }}></span>{`\n  `}<img parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-image\",\n          \"alt\": \"9\",\n          \"title\": \"9\",\n          \"src\": \"/refarch-eda/static/07493609b1181608281aead63a8a1cf9/3cbba/kafdrop-eso-esic.png\",\n          \"srcSet\": [\"/refarch-eda/static/07493609b1181608281aead63a8a1cf9/7fc1e/kafdrop-eso-esic.png 288w\", \"/refarch-eda/static/07493609b1181608281aead63a8a1cf9/a5df1/kafdrop-eso-esic.png 576w\", \"/refarch-eda/static/07493609b1181608281aead63a8a1cf9/3cbba/kafdrop-eso-esic.png 1152w\", \"/refarch-eda/static/07493609b1181608281aead63a8a1cf9/0b124/kafdrop-eso-esic.png 1728w\", \"/refarch-eda/static/07493609b1181608281aead63a8a1cf9/f2b4c/kafdrop-eso-esic.png 2268w\"],\n          \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n          \"style\": {\n            \"width\": \"100%\",\n            \"height\": \"100%\",\n            \"margin\": \"0\",\n            \"verticalAlign\": \"middle\",\n            \"position\": \"absolute\",\n            \"top\": \"0\",\n            \"left\": \"0\"\n          },\n          \"loading\": \"lazy\"\n        }}></img>{`\n    `}</span></p>\n    <p>{`you may have any now.`}</p>\n    <h2>{`Start Producer to source cluster`}</h2>\n    <p>{`As seen in lab 1, we will use the same python script to create products records. This time the script is producing products data to Event Streams on OpenShift. So we need the URL, pem, and user to access this cluster.`}</p>\n    <p>{`The credentials can be accessed and defined using the GUI. `}<a parentName=\"p\" {...{\n        \"href\": \"https://ibm-cloud-architecture.github.io/refarch-eda/use-cases/overview/pre-requisites#getting-scram-authentication-from-event-streams-on-openshift\"\n      }}>{`This section in common use case prerequisite note`}</a>{` goes into the details on how to get the external URL and Scram password. `}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`If not done before download the pem file using the following CLI commands:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`cloudctl login -a https://cp-console.apps.eda-solutions.gse-ocp.net --skip-ssl-validation\ncloudctl es init\ncloudctl es certificates --format pem\n`}</code></pre>\n        <p parentName=\"li\">{`save this `}<inlineCode parentName=\"p\">{`.pem`}</inlineCode>{` file under `}<inlineCode parentName=\"p\">{`mirror-maker2`}</inlineCode>{` folder.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Get userid, password and information of one of thesram based authentication user defined previously. The namespace used below is the one where event streams is installed.`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc get kafkausers \n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Set the following environment variables:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`ES_OCP_BROKERS=light-es-kafka-bootstrap-integration.gse-eda-2020-10-0143c5dd31acd8e030a1d6e0ab1380e3-0000.us-south.containers.appdomain.cloud:443\nES_OCP_USER=es-scram-user\nES_OCP_PASSWORD=$(oc get secret $ES_OCP_USER --namespace integration -o jsonpath='{.data.password}' | base64 --decode)\nES_OCP_CERT=/home/es-cert.pem\nES_OCP_SASL_MECHANISM=SCRAM-SHA-512\n\n`}</code></pre>\n        <p parentName=\"li\">{`Now send five records:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`cd mirror-maker-2\n./sendProductRecords.sh es-ocp\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Going to the Event Streams Console we can see the message in the `}<inlineCode parentName=\"p\">{`products`}</inlineCode>{` topic.`}</p>\n        <h2 parentName=\"li\">{`Understanding MirrorMaker 2 trace`}</h2>\n      </li>\n    </ul>\n    <p>{`A lot of configuration validation at the beginning of the trace to get the connection to both clusters. Any configuration issue to define the connection is generally well reported. URL, TLS certificate, secrets are the common cause of connection issues.`}</p>\n    <p>{`If some messages happen with NO_LEADER for one of the topics, this means MM2 is not able to create the topic on the target cluster and so it is needed to create the topic with command or User Interface.`}</p>\n    <p>{`Then we can observe the following:`}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`It creates a producer to the target cluster for the offsets topics: `}<inlineCode parentName=\"p\">{` [Producer clientId=producer-1] Cluster ID: Bj7Ui3UPQaKtJx7HOkWxPw`}</inlineCode></p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`It creates consumer for the 25 offset topic partitions: `}<inlineCode parentName=\"p\">{`[Consumer clientId=consumer-mirrormaker2-cluster-1, groupId=mirrormaker2-cluster] Subscribed to partition(s): mirrormaker2-cluster-offsets-0,....`}</inlineCode></p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`One Kafka connect worker is started: `}<inlineCode parentName=\"p\">{`Worker started ... Starting KafkaBasedLog with topic mirrormaker2-cluster-status`}</inlineCode></p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Create a producer and consumers for the `}<inlineCode parentName=\"p\">{` mirrormaker2-cluster-status`}</inlineCode>{` topic for 5 partitions`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Create another producer and consumer for the `}<inlineCode parentName=\"p\">{`mirrormaker2-cluster-config`}</inlineCode>{` topic`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Create WorkerSourceTask{id=es-1->es-ic.MirrorHeartbeatConnector-0} is the connector - task for the internal HeartBeat.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`WorkerSourceTask{id=es-1->es-ic.MirrorSourceConnector-0} for the topic to replicate`}</p>\n      </li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}