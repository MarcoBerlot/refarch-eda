(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{QBnI:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return o})),a.d(t,"default",(function(){return u}));var r=a("wx14"),n=a("zLVn"),c=(a("q1tI"),a("7ljp")),s=a("013z"),o=(a("qKvR"),{}),i=function(e){return function(t){return console.warn("Component '"+e+"' was not imported, exported, or provided by MDXProvider as global scope"),Object(c.b)("div",t)}},l=i("AnchorLinks"),p=i("AnchorLink"),b={_frontmatter:o},m=s.a;function u(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(c.b)(m,Object(r.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(c.b)(l,{mdxType:"AnchorLinks"},Object(c.b)(p,{mdxType:"AnchorLink"},"Overview"),Object(c.b)(p,{mdxType:"AnchorLink"},"Start Mirror Maker 2"),Object(c.b)(p,{mdxType:"AnchorLink"},"Start Consumer from target cluster"),Object(c.b)(p,{mdxType:"AnchorLink"},"Start Producer to source cluster")),Object(c.b)("h2",null,"Overview"),Object(c.b)("p",null,"For this scenario the source cluster is an Event Streams on premise on OpenShift, and the target cluster is an Event Stream on Cloud. Mirror Maker 2 runs on OpenShift."),Object(c.b)("p",null," ",Object(c.b)("span",Object(r.a)({parentName:"p"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(c.b)("span",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"37.5%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0klEQVQoz22Sv24TQRCH/Ra8BjU9PW8ABQ8AfSTqlEh0KZAQojAhkQISAiKKFERCIggUOzFObGPHjpPz+f7t7u3d7u3H2KFBYqXR3O3tffOb32yrLANVxTrmVzCbBeI4EJzsyzetQVcO5Uu0s1gcnsBluSS2OcZV+FBhG8u1NbS8rwSwoN//xWKxpK4bgdf0rmvmeYWzUqA0RKpAW8v5aMBo/JvaOVzjIQQmiWcQNSSlpVVoQ7fbYWvrOT9/HLNa3jc8O3Tsn9bYoqEzTbGiJEky2u0227s766K+CXI6sHvieXVUy54orGpPlnmWS0ccafLCYrRjnjgyJSqqwMllgvUWLxDnalFq0EqhjBKBXtr1KOsojADvP97gzr2HvHi9t1b37dMZLzcOePv0qxwoSHXF8STBlJ68dJylEeM8Fe8axr2U7c1D3mx+YdqL1h639j5+Zuf9PhezOZ3BBZ3ukHF/xvh8TlmJWoEMo5yoSLl78IRb7x5w+8MjpipGpSXdowGn30cUqZYiAuS/K/zNMiDbiDJpc3ElgxrSjydMM7kO4l8IzT9/rYFZYslz6b8QH9RNaNVIltDyXgRM7TDiYZCJeoE48W3V3urKrPLNs3Cc4Q/JVlYyZJRoyQAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(c.b)("img",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"1",title:"1",src:"/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/3cbba/mm2-a-a.png",srcSet:["/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/7fc1e/mm2-a-a.png 288w","/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/a5df1/mm2-a-a.png 576w","/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/3cbba/mm2-a-a.png 1152w","/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/d534d/mm2-a-a.png 1498w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    ")),Object(c.b)("h2",null,"Start Mirror Maker 2"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Login to the OpenShift cluster using the console and get the API token"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc login --token=L0.... --server=https://api.eda-solutions.gse-ocp.net:6443\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"You have to decide if you want to isolate mirror maker 2 pods in its own namespace or runs in the same namespace as Event Streams. For completeness we will create our own namespace / OCP project. Create a project in OpenShift to deploy Mirror Maker cluster, for example: "),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc new-project mm2-es\n")),Object(c.b)("p",{parentName:"li"},"If you have already created this project, use this command to be in this project context: ",Object(c.b)("inlineCode",{parentName:"p"},"oc project mm2-es"),".")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Create a secret for the API KEY of the Event Streams target cluster:"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"})," oc create secret generic es-oc-api-secret --from-literal=password=<replace-with-event-streams-on-cloud-apikey>\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Verify the Event Streams on OpenShift route and end point URL. This URL will be used to configure Mirror Maker 2. "),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"# Go to the project where Event Streams is installed\noc project integration\n# Get the bootstrap URL\noc get routes es-1-kafka-bootstrap  -o=jsonpath='{.status.ingress[0].host}{\"\\n\"}'\n# result:\n   es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Copy the CA cluster and clients certificate secrets from the event streams project (",Object(c.b)("inlineCode",{parentName:"p"},"integration"),") and the target project:"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),' oc get secret es-1-cluster-ca-cert -n integration -o yaml | sed s/"namespace: integration"/"namespace: mm2-es"/ | oc apply -n mm2-es -f -\n\n oc get secret es-1-clients-ca-cert -n integration -o yaml | sed s/"namespace: integration"/"namespace: mm2-es"/ | oc apply -n mm2-es -f -\n'))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Get the TLS CA root certificate from the event streams brokers"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc get secrets\noc extract secret/es-1-cluster-ca-cert --keys=ca.crt --to=- > ca.crt\noc extract secret/es-1-clients-ca-cert --keys=ca.crt --to=- >> ca.crt\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Transform the certificates for java truststore"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"keytool -import -trustcacerts -alias root -file ca.crt -keystore truststore.jks -storepass password -noprompt\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Create a secret from the truststore file so it can be mounted as needed into consumer or producer running in the same OpenShift cluster. "),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc project mm2-es\noc create secret generic es-1-truststore --from-file=./truststore.jks\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Define source and target cluster properties in a Mirror Maker 2 ",Object(c.b)("inlineCode",{parentName:"p"},"es-mm2.yml")," descriptor file. There is a file for the replication between Event Streams OCP to Event Streams on cloud ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:""}),"es-ocp-to-es-oc.yml"),". We strongly recommend to study the schema definition of this ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/strimzi/strimzi-kafka-operator/blob/2d35bfcd99295bef8ee98de9d8b3c86cb33e5842/install/cluster-operator/048-Crd-kafkamirrormaker2.yaml#L648-L663"}),"custom resource from this page"),". "))),Object(c.b)("p",null,"Here are some important parameters: The namespace needs to match the newly created project:"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),"apiVersion: kafka.strimzi.io/v1alpha1\nkind: KafkaMirrorMaker2\nmetadata:\n  name: es-1\n  namespace: mm2-es\nspec:\n  version: 2.5.0\n  replicas: 1\n")),Object(c.b)("p",null,"The version matches the Kafka version we use. The number of replicas can be set to 1 to start."),Object(c.b)("p",null,"Then the yaml defined the connection configuration for each clusters: Event Streams on cloud, so you need to define the bootstrap servers (This could come from a config map too) and the API key coming from the previously defined secret."),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'clusters:\n  - alias: "event-streams-wdc"\n    bootstrapServers: broker-0-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-1-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n    tls: {}\n    authentication:\n      passwordSecret:\n          secretName: es-oc-api-secret  \n          password: password \n      username: token\n      type: plain\n')),Object(c.b)("p",null,"For Event Streams on premise running within OpenShift, the connection uses TLS and the certificates."),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'- alias: "es-1-cluster"\n    bootstrapServers: es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n      ssl.endpoint.identification.algorithm: https\n    tls: \n      trustedCertificates:\n        - secretName: es-1-clients-ca-cert\n          certificate: ca.crt\n        - secretName: es-1-cluster-ca-cert\n          certificate: ca.crt\n\n          \n')),Object(c.b)("p",null,"Finally the ",Object(c.b)("inlineCode",{parentName:"p"},"connectCluster")," attribute defines the cluster alias used for Kafka Connect, it must match a cluster in the list at ",Object(c.b)("inlineCode",{parentName:"p"},"spec.clusters"),"."),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc apply -f mirror-maker-2/es-ocp/es-ocp-to-es-oc.yml\n")),Object(c.b)("p",null," oc describe kafkamirrormaker2 mm2-es-1"),Object(c.b)("h2",null,"Start Consumer from target cluster"),Object(c.b)("p",null,"Specifying the target cluster as Event Streams on cloud, we can also use Kafdrop to see the replicated topic."),Object(c.b)("h2",null,"Start Producer to source cluster"))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-scenarios-kafka-mm-2-lab-2-index-mdx-60b6cfdd71017a259a11.js.map