{"version":3,"sources":["webpack:///./src/pages/scenarios/kafka-mm2/lab-2/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","AnchorLinks","AnchorLink","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-scenarios-kafka-mm-2-lab-2-index-mdx-60b6cfdd71017a259a11.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/refarch-eda/refarch-eda/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component '\" + name + \"' was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <AnchorLinks mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Overview</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Start Mirror Maker 2</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Start Consumer from target cluster</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Start Producer to source cluster</AnchorLink>\n    </AnchorLinks>\n    <h2>{`Overview`}</h2>\n    <p>{`For this scenario the source cluster is an Event Streams on premise on OpenShift, and the target cluster is an Event Stream on Cloud. Mirror Maker 2 runs on OpenShift.`}</p>\n    <p>{` `}<span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1152px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"37.5%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0klEQVQoz22Sv24TQRCH/Ra8BjU9PW8ABQ8AfSTqlEh0KZAQojAhkQISAiKKFERCIggUOzFObGPHjpPz+f7t7u3d7u3H2KFBYqXR3O3tffOb32yrLANVxTrmVzCbBeI4EJzsyzetQVcO5Uu0s1gcnsBluSS2OcZV+FBhG8u1NbS8rwSwoN//xWKxpK4bgdf0rmvmeYWzUqA0RKpAW8v5aMBo/JvaOVzjIQQmiWcQNSSlpVVoQ7fbYWvrOT9/HLNa3jc8O3Tsn9bYoqEzTbGiJEky2u0227s766K+CXI6sHvieXVUy54orGpPlnmWS0ccafLCYrRjnjgyJSqqwMllgvUWLxDnalFq0EqhjBKBXtr1KOsojADvP97gzr2HvHi9t1b37dMZLzcOePv0qxwoSHXF8STBlJ68dJylEeM8Fe8axr2U7c1D3mx+YdqL1h639j5+Zuf9PhezOZ3BBZ3ukHF/xvh8TlmJWoEMo5yoSLl78IRb7x5w+8MjpipGpSXdowGn30cUqZYiAuS/K/zNMiDbiDJpc3ElgxrSjydMM7kO4l8IzT9/rYFZYslz6b8QH9RNaNVIltDyXgRM7TDiYZCJeoE48W3V3urKrPLNs3Cc4Q/JVlYyZJRoyQAAAABJRU5ErkJggg==')\",\n            \"backgroundSize\": \"cover\",\n            \"display\": \"block\"\n          }\n        }}></span>{`\n  `}<img parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-image\",\n          \"alt\": \"1\",\n          \"title\": \"1\",\n          \"src\": \"/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/3cbba/mm2-a-a.png\",\n          \"srcSet\": [\"/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/7fc1e/mm2-a-a.png 288w\", \"/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/a5df1/mm2-a-a.png 576w\", \"/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/3cbba/mm2-a-a.png 1152w\", \"/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/d534d/mm2-a-a.png 1498w\"],\n          \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n          \"style\": {\n            \"width\": \"100%\",\n            \"height\": \"100%\",\n            \"margin\": \"0\",\n            \"verticalAlign\": \"middle\",\n            \"position\": \"absolute\",\n            \"top\": \"0\",\n            \"left\": \"0\"\n          },\n          \"loading\": \"lazy\"\n        }}></img>{`\n    `}</span></p>\n    <h2>{`Start Mirror Maker 2`}</h2>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Login to the OpenShift cluster using the console and get the API token`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc login --token=L0.... --server=https://api.eda-solutions.gse-ocp.net:6443\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`You have to decide if you want to isolate mirror maker 2 pods in its own namespace or runs in the same namespace as Event Streams. For completeness we will create our own namespace / OCP project. Create a project in OpenShift to deploy Mirror Maker cluster, for example: `}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc new-project mm2-es\n`}</code></pre>\n        <p parentName=\"li\">{`If you have already created this project, use this command to be in this project context: `}<inlineCode parentName=\"p\">{`oc project mm2-es`}</inlineCode>{`.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Create a secret for the API KEY of the Event Streams target cluster:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{` oc create secret generic es-oc-api-secret --from-literal=password=<replace-with-event-streams-on-cloud-apikey>\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Verify the Event Streams on OpenShift route and end point URL. This URL will be used to configure Mirror Maker 2. `}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`# Go to the project where Event Streams is installed\noc project integration\n# Get the bootstrap URL\noc get routes es-1-kafka-bootstrap  -o=jsonpath='{.status.ingress[0].host}{\"\\\\n\"}'\n# result:\n   es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Copy the CA cluster and clients certificate secrets from the event streams project (`}<inlineCode parentName=\"p\">{`integration`}</inlineCode>{`) and the target project:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{` oc get secret es-1-cluster-ca-cert -n integration -o yaml | sed s/\"namespace: integration\"/\"namespace: mm2-es\"/ | oc apply -n mm2-es -f -\n\n oc get secret es-1-clients-ca-cert -n integration -o yaml | sed s/\"namespace: integration\"/\"namespace: mm2-es\"/ | oc apply -n mm2-es -f -\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Get the TLS CA root certificate from the event streams brokers`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc get secrets\noc extract secret/es-1-cluster-ca-cert --keys=ca.crt --to=- > ca.crt\noc extract secret/es-1-clients-ca-cert --keys=ca.crt --to=- >> ca.crt\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Transform the certificates for java truststore`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`keytool -import -trustcacerts -alias root -file ca.crt -keystore truststore.jks -storepass password -noprompt\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Create a secret from the truststore file so it can be mounted as needed into consumer or producer running in the same OpenShift cluster. `}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`oc project mm2-es\noc create secret generic es-1-truststore --from-file=./truststore.jks\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Define source and target cluster properties in a Mirror Maker 2 `}<inlineCode parentName=\"p\">{`es-mm2.yml`}</inlineCode>{` descriptor file. There is a file for the replication between Event Streams OCP to Event Streams on cloud `}<a parentName=\"p\" {...{\n            \"href\": \"\"\n          }}>{`es-ocp-to-es-oc.yml`}</a>{`. We strongly recommend to study the schema definition of this `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/strimzi/strimzi-kafka-operator/blob/2d35bfcd99295bef8ee98de9d8b3c86cb33e5842/install/cluster-operator/048-Crd-kafkamirrormaker2.yaml#L648-L663\"\n          }}>{`custom resource from this page`}</a>{`. `}</p>\n      </li>\n    </ul>\n    <p>{`Here are some important parameters: The namespace needs to match the newly created project:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: kafka.strimzi.io/v1alpha1\nkind: KafkaMirrorMaker2\nmetadata:\n  name: es-1\n  namespace: mm2-es\nspec:\n  version: 2.5.0\n  replicas: 1\n`}</code></pre>\n    <p>{`The version matches the Kafka version we use. The number of replicas can be set to 1 to start.`}</p>\n    <p>{`Then the yaml defined the connection configuration for each clusters: Event Streams on cloud, so you need to define the bootstrap servers (This could come from a config map too) and the API key coming from the previously defined secret.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`clusters:\n  - alias: \"event-streams-wdc\"\n    bootstrapServers: broker-0-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-1-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n    tls: {}\n    authentication:\n      passwordSecret:\n          secretName: es-oc-api-secret  \n          password: password \n      username: token\n      type: plain\n`}</code></pre>\n    <p>{`For Event Streams on premise running within OpenShift, the connection uses TLS and the certificates.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`- alias: \"es-1-cluster\"\n    bootstrapServers: es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n      ssl.endpoint.identification.algorithm: https\n    tls: \n      trustedCertificates:\n        - secretName: es-1-clients-ca-cert\n          certificate: ca.crt\n        - secretName: es-1-cluster-ca-cert\n          certificate: ca.crt\n\n          \n`}</code></pre>\n    <p>{`Finally the `}<inlineCode parentName=\"p\">{`connectCluster`}</inlineCode>{` attribute defines the cluster alias used for Kafka Connect, it must match a cluster in the list at `}<inlineCode parentName=\"p\">{`spec.clusters`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc apply -f mirror-maker-2/es-ocp/es-ocp-to-es-oc.yml\n`}</code></pre>\n    <p>{` oc describe kafkamirrormaker2 mm2-es-1`}</p>\n    <h2>{`Start Consumer from target cluster`}</h2>\n    <p>{`Specifying the target cluster as Event Streams on cloud, we can also use Kafdrop to see the replicated topic.`}</p>\n    <h2>{`Start Producer to source cluster`}</h2>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}