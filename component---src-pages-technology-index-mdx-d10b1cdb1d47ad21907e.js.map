{"version":3,"sources":["webpack:///./src/pages/technology/index.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"wPAMaA,G,UAAe,IAOtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,EACF,8BACD,OAAO,YAACJ,EAAD,eAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,sPACA,iEACA,sBACE,kBAAIC,WAAW,MAAf,YAAiC,kBAAIA,WAAW,MAC5C,kBAAIA,WAAW,MAAK,6BAAGA,WAAW,MAAS,CACvC,KAAQ,yEADQ,2DAApB,KAGA,kBAAIA,WAAW,MAAf,iJACA,kBAAIA,WAAW,SAEnB,kBAAIA,WAAW,MAAf,sBAA2C,kBAAIA,WAAW,MACtD,kBAAIA,WAAW,MAAf,OAA4B,6BAAGA,WAAW,MAAS,CAC/C,KAAQ,wGADgB,iCAA5B,KAGA,kBAAIA,WAAW,MAAf,2FACA,kBAAIA,WAAW,MAAf,OAA4B,6BAAGA,WAAW,MAAS,CAC/C,KAAQ,yFADgB,sBAIhC,kBAAIA,WAAW,MAAf,4BAAiD,kBAAIA,WAAW,MAC5D,kBAAIA,WAAW,MAAf,6EACA,kBAAIA,WAAW,MAAf,sFACA,kBAAIA,WAAW,MAAf,qIAA0J,0BAAYA,WAAW,MAAvB,iCAA1J,kBAAuP,0BAAYA,WAAW,MAAvB,uBAAvP,aAAqU,0BAAYA,WAAW,MAAvB,wGACrU,kBAAIA,WAAW,MAAf,uBAA4C,6BAAGA,WAAW,MAAS,CAC/D,KAAQ,iFADgC,wBAIhD,kBAAIA,WAAW,MAAf,8BAEF,iDACA,uBAAK,gCAAMA,WAAW,OAAU,IAA3B,saAEL,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,w1CAwDL,wCACA,sBACE,kBAAIA,WAAW,MAAf,kSACA,kBAAIA,WAAW,MAAf,0BAA+C,6BAAGA,WAAW,MAAS,CAClE,KAAQ,+EADmC,iBAG/C,kBAAIA,WAAW,MAAf,6CAAkE,6BAAGA,WAAW,MAAS,CACrF,KAAQ,iFADsD,oBAAlE,2CAIF,oDACA,sBACE,kBAAIA,WAAW,MAAf,WAAgC,6BAAGA,WAAW,MAAS,CACnD,KAAQ,sBADoB,WAAhC,wCAGA,kBAAIA,WAAW,MAAf,iDAAsE,6BAAGA,WAAW,MAAS,CACzF,KAAQ,6BAD0D,kBAAtE,mHAE+I,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CACzL,UAAa,mBADiJ,sMAM3J,kBAAIA,WAAW,MACpB,kBAAIA,WAAW,MAAf,wJACG,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CACjD,UAAa,mBADS,yDAI5B,kBAAIA,WAAW,MAAf,mJACJ,sBAAQA,WAAW,MAAnB,mBAEE,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,y6BA+BL,sBACE,kBAAIA,WAAW,MAAf,gHAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,osBAyBL,sBACE,kBAAIA,WAAW,MAAf,0CAA+D,0BAAYA,WAAW,MAAvB,0BAA/D,oBAAuJ,0BAAYA,WAAW,MAAvB,uBAAvJ,qCAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,wBADZ,okDA+BL,sBACE,kBAAIA,WAAW,MAAf,+KAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,mBADZ,qSASL,sBACE,kBAAIA,WAAW,MAAf,mHAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,mBADZ,yBAIL,sBACE,kBAAIA,WAAW,MAAf,kJAAuK,kBAAIA,WAAW,MAClL,kBAAIA,WAAW,MAAf,2CAGN,sDACA,sBACE,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,2CAA+D,6BAAGA,WAAW,KAAQ,CACjF,KAAQ,2DADmD,0BAA/D,kCAIF,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,yGACA,kBAAIA,WAAW,MACb,kBAAIA,WAAW,MAAf,iCAGJ,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,oFACN,sBAAQA,WAAW,KAAnB,uBAGE,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,oBADZ,wrIAgFL,sBACE,kBAAIA,WAAW,MAAf,mEACJ,sBAAQA,WAAW,MAAnB,4BAEE,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,oBADZ,0tBAyBL,sBACE,kBAAIA,WAAW,MAAf,8CACJ,sBAAQA,WAAW,MAAnB,sBAEE,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,oBADZ,27JAgGL,sBACE,kBAAIA,WAAW,MAAf,4CACJ,sBAAQA,WAAW,MAAnB,4BAEE,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,oBADZ,yjBAoBL,sBACE,kBAAIA,WAAW,MAAf,MAA2B,0BAAYA,WAAW,MAAvB,oBAA3B,eAAwG,0BAAYA,WAAW,MAAvB,oBAAxG,uIAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,mBADZ,uKAQL,sBACE,kBAAIA,WAAW,MAAf,sDAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,mBADZ,yDAIL,sBACE,kBAAIA,WAAW,MAAf,eAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,mBADZ,yDAIL,uDACA,sBACE,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,2BAA+C,6BAAGA,WAAW,KAAQ,CACjE,KAAQ,6CADmC,gBAA/C,gCAIF,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,oDAAwE,6BAAGA,WAAW,KAAQ,CAC1F,KAAQ,0FAD4D,WAK5E,sBACE,kBAAIA,WAAW,MAAf,oGACJ,sBAAQA,WAAW,MAAnB,iBAEE,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,i+EAgFL,sBACE,kBAAIA,WAAW,MAAf,wCACJ,sBAAQA,WAAW,MAAnB,iBAEE,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,04EAmFL,sBACE,kBAAIA,WAAW,MAAf,oNAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,mBADZ,kQAQL,sBACE,kBAAIA,WAAW,MAAf,mFAEF,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,mBADZ,0CASTJ,EAAWK,gBAAiB","file":"component---src-pages-technology-index-mdx-d10b1cdb1d47ad21907e.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/refarch-eda/refarch-eda/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component '\" + name + \"' was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p>{`We are presenting in this note how to get development and deployment environments to start developing Event Driven microservice solution. We assume OpensShift deployment and at first Java as the main programming language.`}</p>\n    <h2>{`Infrastructure for dev integration test`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`OpenShift`}<ul parentName=\"li\">\n          <li parentName=\"ul\"><a parentName=\"li\" {...{\n              \"href\": \"https://docs.openshift.com/container-platform/4.5/welcome/index.html\"\n            }}>{`OpenShift Container Platform Installation Documentation`}</a>{` `}</li>\n          <li parentName=\"ul\">{`OpenShift Container Platform is flexible and can be installed in a number of different environments - onprem, cloud, and hybrid environments.`}</li>\n          <li parentName=\"ul\"></li>\n        </ul></li>\n      <li parentName=\"ul\">{`Cloud Pak Operators`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Add `}<a parentName=\"li\" {...{\n              \"href\": \"https://www.ibm.com/support/knowledgecenter/SSGT7J_20.2/install/install_online_catalog_sources.html\"\n            }}>{`IBM Common Services operators`}</a>{` `}</li>\n          <li parentName=\"ul\">{`Add the IBM operators to the list of installable operators. Same product note as above.`}</li>\n          <li parentName=\"ul\">{`Get `}<a parentName=\"li\" {...{\n              \"href\": \"https://www.ibm.com/support/knowledgecenter/SSGT7J_20.2/install/entitlement_key.html\"\n            }}>{`entitlement key`}</a></li>\n        </ul></li>\n      <li parentName=\"ul\">{`Cloud Pak for Integration`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Install Cloud pak for integration operator using the Operator hub catalog`}</li>\n          <li parentName=\"ul\">{`Install Cloud pak for integration platform navigator from the operator hub catalog`}</li>\n          <li parentName=\"ul\">{`The previous steps should have installed the common services if they were not installed before. So get the admin password via the `}<inlineCode parentName=\"li\">{`platform-auth-idp-credentials`}</inlineCode>{` secret in the `}<inlineCode parentName=\"li\">{`ibm-common-services`}</inlineCode>{` project. `}<inlineCode parentName=\"li\">{` oc get secret platform-auth-idp-credentials -o jsonpath='{.data.admin_password}' | base64 --decode`}</inlineCode></li>\n          <li parentName=\"ul\">{`More information on `}<a parentName=\"li\" {...{\n              \"href\": \"https://www.ibm.com/support/knowledgecenter/SSGT7J_20.2/install/install.html\"\n            }}>{`CP4I Installation`}</a></li>\n        </ul></li>\n      <li parentName=\"ul\">{`cloud pak for application`}</li>\n    </ul>\n    <h3>{`Deploying Event Streams`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`The instructions are in the [product documentation](https://www.ibm.com/support/knowledgecenter/SSGT7J_20.2/install/install_event_streams.html), and are very simple using the IBM Event Streams operator. Select minimal configuration with persistence. Here is an example of the yaml. Note that there are a few sample yamls that come after you install the Event Streams Operator. This yaml is for Event Streams v10.0 -\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: eventstreams.ibm.com/v1beta1\nkind: EventStreams\nmetadata:\n  name: minimal-prod\n  namespace: cp4i\nspec:\n  version: 10.0.0\n  license:\n    accept: false\n    use: CloudPakForIntegrationProduction\n  adminApi: {}\n  adminUI: {}\n  collector: {}\n  restProducer: {}\n  schemaRegistry:\n    storage:\n      type: persistent-claim\n      size: 100Mi\n      class: enter-storage-class-name-here\n  strimziOverrides:\n    kafka:\n      replicas: 3\n      authorization:\n        type: runas\n      config:\n        inter.broker.protocol.version: '2.5'\n        interceptor.class.names: com.ibm.eventstreams.interceptors.metrics.ProducerMetricsInterceptor\n        log.cleaner.threads: 6\n        log.message.format.version: '2.5'\n        num.io.threads: 24\n        num.network.threads: 9\n        num.replica.fetchers: 3\n        offsets.topic.replication.factor: 3\n      listeners:\n        external:\n          type: route\n          authentication:\n            type: scram-sha-512\n        tls:\n          authentication:\n            type: tls\n      metrics: {}\n      storage:\n        type: persistent-claim\n        size: 4Gi\n        class: enter-storage-class-name-here\n    zookeeper:\n      replicas: 3\n      metrics: {}\n      storage:\n        type: persistent-claim\n        size: 2Gi\n        class: enter-storage-class-name-here\n`}</code></pre>\n    <h3>{`Deploy Strimzi`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`On OpenShift Container Platform v4.0.x to 4.3.x as well as pre-Event Streams v10 the Strimzi Operator will serve most of our needs. It can serve as the base so that we can utilize technologies like KafkaConnect, KafkaConnectS2i, KafkaConnector, Mirror Maker2 and other Custom Resources.`}</li>\n      <li parentName=\"ul\">{`You can install it via `}<a parentName=\"li\" {...{\n          \"href\": \"https://strimzi.io/blog/2019/03/06/strimzi-and-operator-lifecycle-manager/\"\n        }}>{`Operator Hub`}</a></li>\n      <li parentName=\"ul\">{`You can also install the Strimzi and itâ€™s `}<a parentName=\"li\" {...{\n          \"href\": \"https://strimzi.io/docs/operators/master/deploying.html#cluster-operator-str\"\n        }}>{`Cluster Operator`}</a>{` bay applying a yaml file through CLI.`}</li>\n    </ul>\n    <h2>{`Java Developer Environment`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Go with `}<a parentName=\"li\" {...{\n          \"href\": \"http://quarkus.io\"\n        }}>{`Quarkus`}</a>{` so all being set with maven plugin.`}</li>\n      <li parentName=\"ul\">{`You can scaffold your application through the `}<a parentName=\"li\" {...{\n          \"href\": \"https://code.quarkus.io/\"\n        }}>{`Quarkus Web UI`}</a>{` which will allow you to pick and choose your project dependencies. You may also do it through the CLI like so: `}<pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`mvn io.quarkus:quarkus-maven-plugin:1.8.1.Final:create \\\\\n -DprojectGroupId=ibm.garage \\\\\n -DprojectArtifactId=your-application \\\\\n -Dextensions=\"kafka,kafka-streams,quarkus-kafka-streams\"\n`}</code></pre><ul parentName=\"li\">\n          <li parentName=\"ul\">{`If you already have your project created and you know the name of an extension you want ot add, you can do it through the CLI like the following - `}</li>\n        </ul><pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`./mvnw quarkus:add-extension -Dextensions=\"kafka\"\n`}</code></pre></li>\n      <li parentName=\"ul\">{`Hereâ€™s a very simple Quarkus Producer application utilizing MicroProfile Reactive Messaging that sends messages to Event Stream v10 and newer:\n`}<strong parentName=\"li\">{`Producer.java`}</strong></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`package com.ibm.garage.infrastructure;\n\nimport io.reactivex.Flowable;\nimport io.smallrye.reactive.messaging.kafka.KafkaRecord;\nimport org.eclipse.microprofile.reactive.messaging.Outgoing;\nimport javax.enterprise.context.ApplicationScoped;\nimport java.util.Random;\nimport java.util.concurrent.TimeUnit;\n\n\n/**\n * This class produces a message every 5 seconds.\n * The Kafka configuration is specified in the application.properties file.\n*/\n@ApplicationScoped\npublic class Producer {\n    private Random random = new Random();\n\n    @Outgoing(\"mock-producer\")      \n    public Flowable<KafkaRecord<Integer, String>> generate() {\n        return Flowable.interval(5, TimeUnit.SECONDS)    \n                .onBackpressureDrop()\n                .map(tick -> {      \n                    return KafkaRecord.of(random.nextInt(100), String.valueOf(random.nextInt(100)));\n                });\n    }                  \n}\n\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Now we have a simple Quarkus consumer, also using MicroProfile Reactive Messaging and printing the message.`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`package com.ibm.garage.infrastructure;\n\nimport io.quarkus.runtime.ShutdownEvent;\nimport io.quarkus.runtime.StartupEvent;\nimport org.eclipse.microprofile.reactive.messaging.Incoming;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport javax.enterprise.context.ApplicationScoped;\nimport javax.enterprise.event.Observes;\n\n@ApplicationScoped\npublic class Consumer {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(Consumer.class);\n\n    @Incoming(\"mock-consumer\")\n    public void consumingMessage(String incomingMessage) {\n        LOGGER.info(\"Message received from topic = {}\", incomingMessage);\n        //System.out.println(incomingMessage);\n    }\n    \n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Quarkus does itâ€™s configuration via an `}<inlineCode parentName=\"li\">{`application.properties`}</inlineCode>{` file within the `}<inlineCode parentName=\"li\">{`src/main/resources/`}</inlineCode>{` path. A sample properties file.`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-properties\"\n      }}>{`quarkus.http.port=8080\nquarkus.log.console.enable=true\nquarkus.log.console.level=INFO\n\n# Base ES Connection Details\nmp.messaging.connector.smallrye-kafka.bootstrap.servers=\\${BOOTSTRAP_SERVERS}\nmp.messaging.connector.smallrye-kafka.security.protocol=SASL_SSL\nmp.messaging.connector.smallrye-kafka.ssl.protocol=TLSv1.2\nmp.messaging.connector.smallrye-kafka.sasl.mechanism=SCRAM-SHA-512\nmp.messaging.connector.smallrye-kafka.sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \\\\\n                username=\\${SCRAM_USERNAME} \\\\\n                password=\\${SCRAM_PASSWORD};\nmp.messaging.connector.smallrye-kafka.ssl.truststore.location=\\${CERT_LOCATION}\nmp.messaging.connector.smallrye-kafka.ssl.truststore.password=\\${CERT_PASSWORD}\nmp.messaging.connector.smallrye-kafka.ssl.truststore.type=PKCS12\n\n\n# mock message producer configuration\nmp.messaging.outgoing.mock-producer.connector=smallrye-kafka\nmp.messaging.outgoing.mock-producer.topic=\\${TOPIC_NAME}\nmp.messaging.outgoing.mock-producer.value.serializer=org.apache.kafka.common.serialization.StringSerializer\nmp.messaging.outgoing.mock-producer.key.serializer=org.apache.kafka.common.serialization.IntegerSerializer\n\n# Kafka Streams consumer configuration\nmp.messaging.incoming.mock-consumer.connector=smallrye-kafka\nmp.messaging.incoming.mock-consumer.topic=\\${TOPIC_NAME}\nmp.messaging.incoming.mock-consumer.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer\nmp.messaging.incoming.mock-consumer.key.deerializer=org.apache.kafka.common.serialization.IntegerDeserializer\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`There are a few environment variables we need to pass to our properties before we can run it. Replace the values which can be retrieved from the Event Streams on CP4I UI.`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`export BOOTSTRAP_SERVERS=your-external-bootstrap-address:xxxx \\\\\nexport SCRAM_USERNAME=your-scram-username \\\\\nexport SCRAM_PASSWORD=your-scram-password \\\\\nexport TOPIC_NAME=your-topic \\\\\nexport CERT_LOCATION=/your-path-to-cert/es-cert.p12 \\\\\nexport CERT_PASSWORD=your-cert-password\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`To run your applications run the following which will allow hot-reloading (if thatâ€™s a functionality you need)`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`./mvnw quarkus:dev\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Kafka Strimzi image for docker and docker-compose to get up and running quikcly. We have different docker composes files for you to start with:`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`One Broker, one Zookeeper, kafka 2.5`}</li>\n        </ul></li>\n    </ul>\n    <h2>{`Python Developer Environment`}</h2>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`There are a few Python packages but the `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/confluentinc/confluent-kafka-python\"\n          }}>{`Confluent Kafka Python`}</a>{` package can serve our needs.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`For Python environments you can use the Confluent Python package and install the dependency with pip.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`pip install confluent-kafka`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`The following is a very simple Python Producer that will serve as the scaffold:\n`}<strong parentName=\"p\">{`KafkaProducer.py`}</strong></p>\n      </li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-python\"\n      }}>{`import json, os\nfrom confluent_kafka import KafkaError, Producer\n\nclass KafkaProducer:\n\n    def __init__(self, groupID = \"KafkaProducer\"):\n        # Get the producer configuration\n        self.producer_conf = self.getProducerConfiguration(groupID)\n        # Create the producer\n        self.producer = Producer(self.producer_conf)\n\n    def getProducerConfiguration(self,groupID):\n        try:\n            options ={\n                    'bootstrap.servers': os.environ['KAFKA_BROKERS'],\n                    'group.id': groupID\n            }\n            if (os.getenv('KAFKA_PASSWORD','') != ''):\n                # Set security protocol common to ES on prem and on IBM Cloud\n                options['security.protocol'] = 'SASL_SSL'\n                # Depending on the Kafka User, we will know whether we are talking to ES on prem or on IBM Cloud\n                # If we are connecting to ES on IBM Cloud, the SASL mechanism is plain\n                if (os.getenv('KAFKA_USER','') == 'token'):\n                    options['sasl.mechanisms'] = 'PLAIN'\n                # If we are connecting to ES on OCP, the SASL mechanism is scram-sha-512\n                else:\n                    options['sasl.mechanisms'] = 'SCRAM-SHA-512'\n                # Set the SASL username and password\n                options['sasl.username'] = os.getenv('KAFKA_USER','')\n                options['sasl.password'] = os.getenv('KAFKA_PASSWORD','')\n            # If we are talking to ES on prem, it uses an SSL self-signed certificate.\n            # Therefore, we need the CA public certificate for the SSL connection to happen.\n            if (os.path.isfile(os.getenv('KAFKA_CERT','/certs/es-cert.pem'))):\n                options['ssl.ca.location'] = os.getenv('KAFKA_CERT','/certs/es-cert.pem')\n            \n            # Print out the producer configuration\n            self.printProducerConfiguration(options)\n\n            return options\n\n        except KeyError as error:\n            print('[KafkaProducer] - [ERROR] - A required environment variable does not exist: ' + error)\n            exit(1)\n\n    def printProducerConfiguration(self,options):\n        # Printing out producer config for debugging purposes        \n        print(\"[KafkaProducer] - This is the configuration for the producer:\")\n        print(\"[KafkaProducer] - -------------------------------------------\")\n        print('[KafkaProducer] - Bootstrap Server:      {}'.format(options['bootstrap.servers']))\n        if (os.getenv('KAFKA_PASSWORD','') != ''):\n            # Obfuscate password\n            if (len(options['sasl.password']) > 3):\n                obfuscated_password = options['sasl.password'][0] + \"*****\" + options['sasl.password'][len(options['sasl.password'])-1]\n            else:\n                obfuscated_password = \"*******\"\n            print('[KafkaProducer] - Security Protocol:     {}'.format(options['security.protocol']))\n            print('[KafkaProducer] - SASL Mechanism:        {}'.format(options['sasl.mechanisms']))\n            print('[KafkaProducer] - SASL Username:         {}'.format(options['sasl.username']))\n            print('[KafkaProducer] - SASL Password:         {}'.format(obfuscated_password))\n            if (os.path.isfile(os.getenv('KAFKA_CERT','/certs/es-cert.pem'))): \n                print('[KafkaProducer] - SSL CA Location:       {}'.format(options['ssl.ca.location']))\n        print(\"[KafkaProducer] - -------------------------------------------\")\n\n    def delivery_report(self,err, msg):\n        \"\"\" Called once for each message produced to indicate delivery result. Triggered by poll() or flush(). \"\"\"\n        if err is not None:\n            print('[KafkaProducer] - [ERROR] - Message delivery failed: {}'.format(err))\n        else:\n            print('[KafkaProducer] - Message delivered to {} [{}]'.format(msg.topic(), msg.partition()))\n\n    def publishEvent(self, topicName, eventToSend, keyName):\n        # Print the event to send\n        dataStr = json.dumps(eventToSend)\n        # Produce the message\n        self.producer.produce(topicName,key=eventToSend[keyName],value=dataStr.encode('utf-8'), callback=self.delivery_report)\n        # Flush\n        self.producer.flush()\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Now that we have the Producer we need to actually send Events.\n`}<strong parentName=\"li\">{`ProducePlainMessage.py`}</strong></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-python\"\n      }}>{`import argparse\nfrom KafkaProducer import KafkaProducer\n\nif __name__ == '__main__':\n\n    # Parse arguments\n    parser = argparse.ArgumentParser(description=\"Message Producer Example\")\n    parser.add_argument('-t', dest=\"topic\", required=True, help=\"Topic name\")\n    args = parser.parse_args()\n    \n    # Create the event to be sent\n    event = {\"eventKey\" : \"1\", \"message\" : \"This is a test message\"}\n    \n    # Print it out\n    print(\"--- Event to be published: ---\")\n    print(event)\n    print(\"----------------------------------------\")\n    \n    # Create the Kafka Producer\n    kafka_producer = KafkaProducer()\n    # Publish the event\n    kafka_producer.publishEvent(args.topic,event,\"eventKey\")\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`The following is a simple Python consumer\n`}<strong parentName=\"li\">{`KafkaConsumer.py`}</strong></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-python\"\n      }}>{`import json,os\nfrom confluent_kafka import Consumer, KafkaError\n\n\nclass KafkaConsumer:\n\n    def __init__(self, topic_name = \"kafka-producer\", groupID = 'KafkaConsumer', autocommit = True):\n        # Get the consumer configuration\n        self.consumer_conf = self.getConsumerConfiguration(groupID, autocommit)\n        # Create the Avro consumer\n        self.consumer = Consumer(self.consumer_conf)\n        # Subscribe to the topic\n        self.consumer.subscribe([topic_name])\n\n    def getConsumerConfiguration(self, groupID, autocommit):\n        try:\n            options ={\n                    'bootstrap.servers': os.environ['KAFKA_BROKERS'],\n                    'group.id': groupID,\n                    'auto.offset.reset': \"earliest\",\n                    'enable.auto.commit': autocommit,\n            }\n            if (os.getenv('KAFKA_PASSWORD','') != ''):\n                # Set security protocol common to ES on prem and on IBM Cloud\n                options['security.protocol'] = 'SASL_SSL'\n                # Depending on the Kafka User, we will know whether we are talking to ES on prem or on IBM Cloud\n                # If we are connecting to ES on IBM Cloud, the SASL mechanism is plain\n                if (os.getenv('KAFKA_USER','') == 'token'):\n                    options['sasl.mechanisms'] = 'PLAIN'\n                # If we are connecting to ES on OCP, the SASL mechanism is scram-sha-512\n                else:\n                    options['sasl.mechanisms'] = 'SCRAM-SHA-512'\n                # Set the SASL username and password\n                options['sasl.username'] = os.getenv('KAFKA_USER','')\n                options['sasl.password'] = os.getenv('KAFKA_PASSWORD','')\n            # If we are talking to ES on prem, it uses an SSL self-signed certificate.\n            # Therefore, we need the CA public certificate for the SSL connection to happen.\n            if (os.path.isfile(os.getenv('KAFKA_CERT','/certs/es-cert.pem'))):\n                options['ssl.ca.location'] = os.getenv('KAFKA_CERT','/certs/es-cert.pem')\n\n            # Print out the producer configuration\n            self.printConsumerConfiguration(options)\n\n            return options\n\n        except KeyError as error:\n            print('[KafkaConsumer] - [ERROR] - A required environment variable does not exist: ' + error)\n            exit(1)\n    \n    def printConsumerConfiguration(self,options):\n        # Printing out consumer config for debugging purposes        \n        print(\"[KafkaConsumer] - This is the configuration for the consumer:\")\n        print(\"[KafkaConsumer] - -------------------------------------------\")\n        print('[KafkaConsumer] - Bootstrap Server:      {}'.format(options['bootstrap.servers']))\n        if (os.getenv('KAFKA_PASSWORD','') != ''):\n            # Obfuscate password\n            if (len(options['sasl.password']) > 3):\n                obfuscated_password = options['sasl.password'][0] + \"*****\" + options['sasl.password'][len(options['sasl.password'])-1]\n            else:\n                obfuscated_password = \"*******\"\n            print('[KafkaConsumer] - Security Protocol:     {}'.format(options['security.protocol']))\n            print('[KafkaConsumer] - SASL Mechanism:        {}'.format(options['sasl.mechanisms']))\n            print('[KafkaConsumer] - SASL Username:         {}'.format(options['sasl.username']))\n            print('[KafkaConsumer] - SASL Password:         {}'.format(obfuscated_password))\n            if (os.path.isfile(os.getenv('KAFKA_CERT','/certs/es-cert.pem'))): \n                print('[KafkaConsumer] - SSL CA Location:       {}'.format(options['ssl.ca.location']))\n        print('[KafkaConsumer] - Offset Reset:          {}'.format(options['auto.offset.reset']))\n        print('[KafkaConsumer] - Autocommit:            {}'.format(options['enable.auto.commit']))\n        print(\"[KafkaConsumer] - -------------------------------------------\")\n    \n    # Prints out and returns the decoded events received by the consumer\n    def traceResponse(self, msg):\n        print('[KafkaConsumer] - Next Message consumed from {} partition: [{}] at offset: {}\\\\n\\\\tkey: {}\\\\n\\\\tvalue: {}'\n                    .format(msg.topic(), msg.partition(), msg.offset(), msg.key().decode('utf-8'), msg.value().decode('utf-8')))\n\n    # Polls for next event\n    def pollNextEvent(self):\n        # Poll for messages\n        msg = self.consumer.poll(timeout=10.0)\n        # Validate the returned message\n        if msg is None:\n            print(\"[KafkaConsumer] - [INFO] - No new messages on the topic\")\n        elif msg.error():\n            if (\"PARTITION_EOF\" in msg.error()):\n                print(\"[KafkaConsumer] - [INFO] - End of partition\")\n            else:\n                print(\"[KafkaConsumer] - [ERROR] - Consumer error: {}\".format(msg.error()))\n        else:\n            # Print the message\n            self.traceResponse(msg)\n    \n    def close(self):\n        self.consumer.close()\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Now for the plain Kafka Python consumer\n`}<strong parentName=\"li\">{`ConsumePlainMessage.py`}</strong></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-python\"\n      }}>{`import argparse\nfrom KafkaConsumer import KafkaConsumer\n\n####################### MAIN #######################\nif __name__ == '__main__':\n    \n    # Parse arguments\n    parser = argparse.ArgumentParser(description=\"Message Consumer Example\")\n    parser.add_argument('-t', dest=\"topic\", required=True, help=\"Topic name\")\n    args = parser.parse_args()\n\n    # Create a Kafka Consumer\n    kafka_consumer = KafkaConsumer(args.topic)\n    # Poll for next message\n    kafka_consumer.pollNextEvent()\n    # Close the consumer\n    kafka_consumer.close()\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`In `}<inlineCode parentName=\"li\">{`KafkaProducer.py`}</inlineCode>{` as well as `}<inlineCode parentName=\"li\">{`KafkaConsumer.py`}</inlineCode>{` we will need to provide environment variables so that our producer can parse it and actually connect to an Event Streams intance.`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`export KAFKA_BROKERS=your-brokers \\\\\nexport KAFKA_USER=your-scram-username \\\\\nexport KAFKA_PASSWORD=your-scram-password \\\\\nexport KAFKA_CERT=your-cert-path\n\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`To run your Producer and send a simple message - `}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`python ProducePlainMessage.py -t <your-topic-name>\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`To consume`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`python ConsumePlainMessage.py -t <your-topic-name>\n`}</code></pre>\n    <h2>{`Node.js Developer Environment`}</h2>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`We will make use of the `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/Blizzard/node-rdkafka\"\n          }}>{`node-rdkafka`}</a>{` library for our purposes. `}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`The following code is based off this application `}<a parentName=\"p\" {...{\n            \"href\": \"https://chrisphillips-cminion.github.io/eventstreams/2019/08/22/NodeJS-IBMES-101.html\"\n          }}>{`here`}</a></p>\n      </li>\n    </ul>\n    <ul>\n      <li parentName=\"ul\">{`Here is a simple Node.js producer application that will produce 20 messages to the Kafka topic.\n`}<strong parentName=\"li\">{`producer.js`}</strong></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-node\"\n      }}>{`var Kafka = require('node-rdkafka');\n\nvar kafka_options = {\n    //'debug': 'all',\n    'metadata.broker.list': process.env.KAFKA_BROKERS,\n    'security.protocol': 'sasl_ssl',\n    'sasl.mechanisms': 'SCRAM-SHA-512',\n    'sasl.username': process.env.SCRAM_USERNAME,\n    'sasl.password': process.env.SCRAM_PASSWORD,\n    'ssl.ca.location': process.env.PEM_PATH,\n    'log.connection.close' : false,\n    'client.id': 'ES-NodeJS-101'\n};\n\nvar topicName = process.env.TOPIC_NAME\n\nproducer = new Kafka.Producer(kafka_options);\nproducer.setPollInterval(100);\n// Register listener for debug information; only invoked if debug option set in kafka_options\nproducer.on('event.log', function(log) {\n    console.log(log);\n});\n// Register error listener\nproducer.on('event.error', function(err) {\n    console.error('Error from producer:' + JSON.stringify(err));\n});\n\n// Register delivery report listener\nproducer.on('delivery-report', function(err, dr) {\n    if (err) {\n        console.error('Delivery report: Failed sending message ' + dr.value);\n        console.error(err);\n        // We could retry sending the message\n    } else {\n        console.log('Message produced, partition: ' + dr.partition + ' offset: ' + dr.offset);\n    }\n});\n\nvar sendMessageToTopic = function() {\n    console.log('The producer has connected.');\n    const genMessage = i => new Buffer.from(\\`Kafka example, message number \\${i}\\`);\n    console.log('Producer is now sending 20 messages to the Kafka Topic');\n    const maxMessages = 20;\n    for (var i = 0; i < maxMessages; i++) {\n        producer.produce(topicName, -1, genMessage(i), i);\n    }\n}\n\n// Register callback invoked when producer has connected\nproducer.on('ready', function() {\n\n    sendMessageToTopic();\n\n    // request metadata for all topics\n    producer.getMetadata({\n        timeout: 10000\n    },\n    function(err, metadata) {\n        if (err) {\n            console.error('Error getting metadata: ' + JSON.stringify(err));\n            shutdown(-1);\n        } else {\n            console.log('Producer obtained metadata: ' + JSON.stringify(metadata));\n            var topicsByName = metadata.topics.filter(function(t) {\n                return t.name === topicName;\n            });\n            if (topicsByName.length === 0) {\n                console.error('ERROR - Topic ' + topicName + ' does not exist. Exiting');\n                shutdown(-1);\n            }\n        }\n    });\n    var counter = 0;\n});\n\nproducer.connect();\n\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Below is a simple Node.js consumer:\n`}<strong parentName=\"li\">{`consumer.js`}</strong></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-node\"\n      }}>{`var Kafka = require('node-rdkafka');\n\nvar kafka_options = {\n    //'debug': 'all',\n    'metadata.broker.list': process.env.KAFKA_BROKERS,\n    'security.protocol': 'sasl_ssl',\n    'sasl.mechanisms': 'SCRAM-SHA-512',\n    'sasl.username': process.env.SCRAM_USERNAME,\n    'sasl.password': process.env.SCRAM_PASSWORD,\n    'ssl.ca.location': process.env.PEM_PATH,\n    'log.connection.close' : false,\n    'group.id': 'ES-NodeJS-101-consumer'\n};\n\n\n\nvar topicName = process.env.TOPIC_NAME\n\nconst consumer = new Kafka.KafkaConsumer(kafka_options, {\n    \"auto.offset.reset\": \"beginning\"\n  });\n\n\nconsumer.on('event.log', function(log) {\n    console.log(log);\n});\n\n// Register error listener\nconsumer.on('event.error', function(err) {\n    console.error('Error from consumer:' + JSON.stringify(err));\n});\n\nvar consumedMessages = []\n// Register callback to be invoked when consumer has connected\nconsumer.on('ready', function() {\n    console.log('The consumer has connected.');\n\n    // request metadata for one topic\n    consumer.getMetadata({\n        topic: topicName,\n        timeout: 10000\n    },\n    function(err, metadata) {\n        if (err) {\n            console.error('Error getting metadata: ' + JSON.stringify(err));\n            shutdown(-1);\n        } else {\n            console.log('Consumer obtained metadata: ' + JSON.stringify(metadata));\n\n        }\n    });\n\n    consumer.subscribe([topicName]);\n\n    consumerLoop = setInterval(function () {\n        if (consumer.isConnected()) {\n            // The consume(num, cb) method can take a callback to process messages.\n            // In this sample code we use the \".on('data')\" event listener instead,\n            // for illustrative purposes.\n            consumer.consume(10);\n        }    \n\n        if (consumedMessages.length === 0) {\n            console.log('No messages consumed');\n        } else {\n            for (var i = 0; i < consumedMessages.length; i++) {\n                var m = consumedMessages[i];\n                console.log('Message consumed: topic=' + m.topic + ', partition=' + m.partition + ', offset=' + m.offset + ', key=' + m.key + ', value=' + m.value.toString());\n            }\n            consumedMessages = [];\n        }\n    }, 2000);\n});\n\n// Register a listener to process received messages\nconsumer.on('data', function(m) {\n    consumedMessages.push(m);\n});\n\nconsumer.connect()\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Like the Python environments, we will need a SCRAM Username, password, and the PEM Certificate. We will need a few environment variables to provide to our application so that it can connect to Event Streams.`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`export KAFKA_BROKERS=your-external-bootstrap-server-address \\\\\nexport SCRAM_USERNAME=your-scram-username \\\\\nexport SCRAM_PASSWORD=your-scram-password \\\\\nexport TOPIC_NAME=your-topic-name \\\\\nexport PEM_PATH=/path-to-your-pem-certificate/es-cert.pem\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`To run these applications after exporting the necessary environment variables:`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`node producer.js\nnode consumer.js\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}