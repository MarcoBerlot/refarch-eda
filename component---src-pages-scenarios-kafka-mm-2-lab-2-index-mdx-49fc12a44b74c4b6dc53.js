(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{QBnI:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return d}));var r=a("wx14"),n=a("zLVn"),c=(a("q1tI"),a("7ljp")),s=a("013z"),i=(a("qKvR"),{}),o=function(e){return function(t){return console.warn("Component '"+e+"' was not imported, exported, or provided by MDXProvider as global scope"),Object(c.b)("div",t)}},l=o("AnchorLinks"),p=o("AnchorLink"),b={_frontmatter:i},m=s.a;function d(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(c.b)(m,Object(r.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(c.b)(l,{mdxType:"AnchorLinks"},Object(c.b)(p,{mdxType:"AnchorLink"},"Overview"),Object(c.b)(p,{mdxType:"AnchorLink"},"Pre-requisites"),Object(c.b)(p,{mdxType:"AnchorLink"},"Start Mirror Maker 2"),Object(c.b)(p,{mdxType:"AnchorLink"},"Start Consumer from target cluster"),Object(c.b)(p,{mdxType:"AnchorLink"},"Start Producer to source cluster")),Object(c.b)("h2",null,"Overview"),Object(c.b)("p",null,"For this scenario the source cluster is an Event Streams on premise on OpenShift, and the target cluster is an Event Stream on Cloud. Mirror Maker 2 runs on OpenShift."),Object(c.b)("p",null," ",Object(c.b)("span",Object(r.a)({parentName:"p"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(c.b)("span",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"37.5%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0klEQVQoz22Sv24TQRCH/Ra8BjU9PW8ABQ8AfSTqlEh0KZAQojAhkQISAiKKFERCIggUOzFObGPHjpPz+f7t7u3d7u3H2KFBYqXR3O3tffOb32yrLANVxTrmVzCbBeI4EJzsyzetQVcO5Uu0s1gcnsBluSS2OcZV+FBhG8u1NbS8rwSwoN//xWKxpK4bgdf0rmvmeYWzUqA0RKpAW8v5aMBo/JvaOVzjIQQmiWcQNSSlpVVoQ7fbYWvrOT9/HLNa3jc8O3Tsn9bYoqEzTbGiJEky2u0227s766K+CXI6sHvieXVUy54orGpPlnmWS0ccafLCYrRjnjgyJSqqwMllgvUWLxDnalFq0EqhjBKBXtr1KOsojADvP97gzr2HvHi9t1b37dMZLzcOePv0qxwoSHXF8STBlJ68dJylEeM8Fe8axr2U7c1D3mx+YdqL1h639j5+Zuf9PhezOZ3BBZ3ukHF/xvh8TlmJWoEMo5yoSLl78IRb7x5w+8MjpipGpSXdowGn30cUqZYiAuS/K/zNMiDbiDJpc3ElgxrSjydMM7kO4l8IzT9/rYFZYslz6b8QH9RNaNVIltDyXgRM7TDiYZCJeoE48W3V3urKrPLNs3Cc4Q/JVlYyZJRoyQAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(c.b)("img",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"1",title:"1",src:"/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/3cbba/mm2-a-a.png",srcSet:["/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/7fc1e/mm2-a-a.png 288w","/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/a5df1/mm2-a-a.png 576w","/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/3cbba/mm2-a-a.png 1152w","/refarch-eda/static/47452b5782936c760d1bd2c3e6495dfc/d534d/mm2-a-a.png 1498w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    ")),Object(c.b)("h2",null,"Pre-requisites"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"We will use the Cloud shell tool, so connect and create the environment for this shell using the same instructions as in ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://ibm-cloud-architecture.github.io/refarch-eda/technology/event-streams/schema-registry-cp4i-v10#ibm-cloud-shell"}),"the schema registry lab"),".")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Login to the OpenShift cluster using the console and get the API token"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc login --token=L0.... --server=https://api.eda-solutions.gse-ocp.net:6443\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Clone the github to get access to the mirror maker 2 manif we are using:"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"git clone https://github.com/ibm-cloud-architecture/refarch-eda-data-consistency\n")))),Object(c.b)("h2",null,"Start Mirror Maker 2"),Object(c.b)("p",null,"In this lab, Mirror Maker 2 will run on the same cluster as Event Streams within the same namespace. "),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Create a secret for the API KEY of the Event Streams target cluster:"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"})," oc create secret generic es-oc-api-secret --from-literal=password=<replace-with-event-streams-on-cloud-apikey>\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Verify the Event Streams on OpenShift route and end point URL. This URL will be used to configure Mirror Maker 2. "),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"# Go to the project where Event Streams is installed\noc project integration\n# Use the bootstrap internal URL\noc describe svc es-1-kafka-bootstrap  -o=jsonpath='{.status.ingress[0].host}{\"\\n\"}'\n# result:\n   es-1-kafka-bootstrap.integration.svc:9093\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Verify the CA certificate secrets:"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"})," oc describe secret es-1-cluster-ca -n integration\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Get a user with write access to topic, transactions. You can use the User Interface to do so with the Create TLS credential on the intern URL panel."),Object(c.b)("span",Object(r.a)({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"719px"}}),"\n      ",Object(c.b)("span",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"62.15277777777778%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABn0lEQVQoz41Ty5LBUBD1l75BKYoqK3b+xsIO32BhwQKjxmIISiJvkXecyWkVNaNkam5Vp29uOqdPn+5b8X0fqqrCMAxYlgVd18Wbpok0TcF1v9/fWvHt56rwkSQJsiyTA4IQUNO0J2DZegUTwOl0ikajgU6ng1qthna7jf1+jyiK4DgOgiAAq+Detm24roswDMsZzmYz9Ho99Pt9Ae12u9jtdrherwISx7GAE4jM6XlWCsiyyIJZ6RlMHWnUlXa5XEQCWqF1KeDtdpOfyYKlEbhgVZRbmOd54l+b9QuQAcxMUHaWDM7ns+z/akYpQwo9n8+xWCyw2Wyw3W6xXq3w8bHGQVFwOChQcn86nXA8HvP3wzPZW4YsjQHUhWwZkGYPi+IEQcjyY5GB40XPkt8ZR0/m8KFVwJxI8oSKFuDzS4OienDzY/OGfy/pcjFjHBXX9aAaVxzPJlTdhW75MB1fWDKWWk8mE4zHY4xGI/G0wWCA5XKJCssgWNEQ/mDb+dUzdDi5tywTdm6cBspDnVutllyGer2OZrMp+2q1iuFwiG8+74bPH1mVKwAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(c.b)("img",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"4",title:"4",src:"/refarch-eda/static/ff1774cceddb2e9f5b1b44c746ae7f71/3f9cb/mm2-cred-1.png",srcSet:["/refarch-eda/static/ff1774cceddb2e9f5b1b44c746ae7f71/7fc1e/mm2-cred-1.png 288w","/refarch-eda/static/ff1774cceddb2e9f5b1b44c746ae7f71/a5df1/mm2-cred-1.png 576w","/refarch-eda/static/ff1774cceddb2e9f5b1b44c746ae7f71/3f9cb/mm2-cred-1.png 719w"],sizes:"(max-width: 719px) 100vw, 719px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(c.b)("span",Object(r.a)({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"561px"}}),"\n      ",Object(c.b)("span",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"41.31944444444445%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABN0lEQVQoz6WQ3XKCMBCFeW1fRn6qdzo6+gCOTyFVCH9Oi8hgCAFEpafJ2tKZXrYX35zNmc3ZTYzRaITJZILxeAzTNAe1bRuO49B5Pp9js9lguVxitVphsVhQrdH1bDbDer3GdruFMZ1O0XUd0jRFURTI8xxZlkFKSb6mbVvUdU3aNA3p/X5H3/cDj8cDt9sNht5Ah+33exwOB8RxPNSe5yEIAjDGEEURXNcd/LIsaYgeXFUVqRAChn4e5xy+79MlHRCG4cAzLB6CGQuo73uY7kmShNDBFJhlJ7i7HZgKZcxXjQyBukyqCHWY//QjGhSoBTwcjwn45TIgpQq0LAuybvGenoniIlA3V/KeXH/pj1/JFqKqUX7BhVR/aL0gzoHX4IwT75GVH3/mrDAs2wFvgLdMIOfdv/kEufdEKPYrWdEAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(c.b)("img",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"5",title:"5",src:"/refarch-eda/static/99039fda507dff0e3a525be1997c9c8d/83583/mm2-cred-2.png",srcSet:["/refarch-eda/static/99039fda507dff0e3a525be1997c9c8d/7fc1e/mm2-cred-2.png 288w","/refarch-eda/static/99039fda507dff0e3a525be1997c9c8d/83583/mm2-cred-2.png 561w"],sizes:"(max-width: 561px) 100vw, 561px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(c.b)("p",{parentName:"li"},"This user needs to be able to create topic on target cluster.\no\n",Object(c.b)("span",Object(r.a)({parentName:"p"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"726px"}}),"\n      ",Object(c.b)("span",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"69.44444444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACUklEQVQ4y3WSy05aURiFz1N00HbkoHXQpHNIqIgBk8aQ+A5N1Q46aec8hkGjvAGXhGBiYowjG6lpDQjRIIJwuByu53BVYPWsnxwL1ZJ82ftn7732+tc+is/nQywWQzAYRCgUQjgcRjQaRSQSwdHREU5PT3F8fCywJoeHhzg5OUE8HhfOzs5wfn6Og4MDKIFAAM1mE3d3d1BVVcZ6vY5Wq4V2uw1N01CtVlGr1TAajWD9xuMx7u/vheFwKHUqlYKys7ODcrmMq6srZDIZXF9fC7N1Op2WMZvNIp/Py6WlUgm6rgu8uN/vTwV3d3fFwc3NjWwuFApz8DDHYrGIXC4ne9kRMQwDnU5HRAeDwVRwb29PCrbU7Xbx8PDw2AphPYvVIqGrWcFkMjnNcDKZyIKVy3OH/4VrFHnWIa3zQZgL87TmdM18CA9x3/94FGSGPMjAmREfgqMVPudc7/V6cwJ0Rp4I0mGj0ZBH4WFL2OL29lbccg8zJhS3xGZbTiQSULa3t6VFClLMEuZIt9b/nBeLKlRTvFAomt9qwxTrQjdFdd0wH2iAy0vT4f7+vjwGb5m9lU6sWpx1zHWjJRh6E72u6arXQb9nyHw8GuLi9y8ofr9fQqfLSqXyhGq1It+eWtWhal2Uax2hpBFD4JrWGuBH/ALK+vo6vF4vPB4PXC4XVlZWHmG97FzCh2U33m3lsfAVeLkBvNoy2fzLa7N+Yf7v+J6Fsra2BofDAbvdDpvNNseS04nVVTfcno94/+knFr/U8GZDxduN0hyLmyoWPmtwf4vjDz2fyFMvoGVYAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(c.b)("img",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"6",title:"6",src:"/refarch-eda/static/b7379c36bf50c0d2392b94d8212c0d95/81f3f/mm2-cred-3.png",srcSet:["/refarch-eda/static/b7379c36bf50c0d2392b94d8212c0d95/7fc1e/mm2-cred-3.png 288w","/refarch-eda/static/b7379c36bf50c0d2392b94d8212c0d95/a5df1/mm2-cred-3.png 576w","/refarch-eda/static/b7379c36bf50c0d2392b94d8212c0d95/81f3f/mm2-cred-3.png 726w"],sizes:"(max-width: 726px) 100vw, 726px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    ")),Object(c.b)("p",{parentName:"li"},"You can specify a specific set of topics, with Java regexp."),Object(c.b)("span",Object(r.a)({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"718px"}}),"\n      ",Object(c.b)("span",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"62.15277777777778%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABx0lEQVQoz42Sy4oaURCGG0OeIuQZzMSFzyDJJCTLmMxqFkIewMvKFzCXjaLoWgVdCi4GvG18g0A2YWa83/pu2922f7qKHJk2wkzDR52uKv9T9bdSJpNBs9lEtVpFrVZjGo0G6vU6Wq0WhsMhut0uer0e+v0+BoMBnylHdDqdY73dbkMql8vYbDaYTCaYTqeMLMtQVRWr1QrL5ZLrdKY8RU3T4Hke9vt9AOqVCoUCN81mM8zn8yP0TpfQebFYBPLr9ZpF6VIRDcPgfimfz3PTaDSCoiiwLIuLpmliu91yPAf1CHRd5xwLlkolTtCqNAGtRUXK0e0UnwL9hjRY0HVdXpugKanBcRz2hWrnELWHEx4FbdtmQwU0pVj7Mc4KUpJ8FILkHXm52+04irPAEvGf3wEPi8UiDocDfzmBEA2K2Cc42Fo2VM2Aovp+6ybGY3/CSqUCemjth/+pU888xwRcHdif4Bl+9IEFeTWGlEgkkM1mkUqlAqTTaT+mkUwm+f3rj1+4+mkinpPx+ZuCuCCncO5TTsP19ztIsVgM0WgU4XD4P15dXCASifi8xosPN3j+cQbpzR+ELm8Rend35Nl7X+jtPV5++Y2/lCJDGrfIWzYAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(c.b)("img",Object(r.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"7",title:"7",src:"/refarch-eda/static/5da6aa2eba14b208b36e51590d2065cf/70c24/mm2-cred-4.png",srcSet:["/refarch-eda/static/5da6aa2eba14b208b36e51590d2065cf/7fc1e/mm2-cred-4.png 288w","/refarch-eda/static/5da6aa2eba14b208b36e51590d2065cf/a5df1/mm2-cred-4.png 576w","/refarch-eda/static/5da6aa2eba14b208b36e51590d2065cf/70c24/mm2-cred-4.png 718w"],sizes:"(max-width: 718px) 100vw, 718px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(c.b)("p",{parentName:"li"},"and all the transactions.")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Define source and target cluster properties in a Mirror Maker 2 ",Object(c.b)("inlineCode",{parentName:"p"},"es-ocp-to-es-oc.yml")," descriptor file. There is a file for the replication between Event Streams OCP to Event Streams on cloud ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:""}),"es-ocp-to-es-oc.yml"),". We strongly recommend to study the schema definition of this ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/strimzi/strimzi-kafka-operator/blob/2d35bfcd99295bef8ee98de9d8b3c86cb33e5842/install/cluster-operator/048-Crd-kafkamirrormaker2.yaml#L648-L663"}),"custom resource from this page"),". "))),Object(c.b)("p",null,"Here are some important parameters: The namespace needs to match the newly created project:"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),"apiVersion: eventstreams.ibm.com/v1alpha1\nkind: KafkaMirrorMaker2\nmetadata:\n  name: mm2\n  namespace: integration\nspec:\n  template:\n    pod:\n      metadata:\n        annotations:\n          eventstreams.production.type: CloudPakForIntegrationNonProduction\n  version: 2.5.0\n  replicas: 1\n")),Object(c.b)("p",null,"The version matches the Kafka version we use. The number of replicas can be set to 1 to start. The eventstreams.production.type is needed for Event Streams."),Object(c.b)("p",null,"Then the yaml defines the connection configuration for each clusters: Event Streams on cloud, so you need to define the bootstrap servers (This could come from a config map too) and the API key coming from the previously defined secret. The user is always ‘token’"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'clusters:\n  - alias: "event-streams-wdc"\n    bootstrapServers: broker-0-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-1-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n    tls: {}\n    authentication:\n      passwordSecret:\n          secretName: es-oc-api-secret  \n          password: password \n      username: token\n      type: plain\n')),Object(c.b)("p",null,"For Event Streams on premise running within OpenShift, the connection uses TLS, certificates and Sram credentials. As we run in a separate namespace the URL is the ‘external’ one."),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'- alias: "es-1-cluster"\n    bootstrapServers: es-1-kafka-bootstrap.integration.svc:9093\n    config:\n      config.storage.replication.factor: 3\n      offset.storage.replication.factor: 3\n      status.storage.replication.factor: 3\n      ssl.endpoint.identification.algorithm: https\n    tls: \n      trustedCertificates:\n        - secretName: es-1-cluster-ca-cert\n          certificate: ca.crt\n    authentication:\n      type: tls\n      certificateAndKey:\n        certificate: user.crt\n        key: user.key\n        secretName: mm2\n          \n')),Object(c.b)("p",null,"Finally the ",Object(c.b)("inlineCode",{parentName:"p"},"connectCluster")," attribute defines the cluster alias used for Kafka Connect, it must match a cluster in the list at ",Object(c.b)("inlineCode",{parentName:"p"},"spec.clusters"),"."),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc apply -f mirror-maker-2/es-ocp/es-ocp-to-es-oc.yml\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Verify the chareacteristics of the Mirror Maker 2 instance using the CLI"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"oc describe kafkamirrormaker2 mm2\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"As Mirror Maker 2 is set to  be connected to the ",Object(c.b)("inlineCode",{parentName:"p"},"es-1-cluster")," which is the event streams on OCP, it will create its internal topic as:"))),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"cloudctl es topics\n..\nmirrormaker2-cluster-configs   \nmirrormaker2-cluster-offsets   \nmirrormaker2-cluster-status   \n")),Object(c.b)("h2",null,"Start Producer to source cluster"),Object(c.b)("p",null,"As seen in lab 1, we will use the same python script to create products records. This time the script is producing products data to Event Streams on OpenShift. So we need the URL, pem, and user to access this cluster.\nThe credentials can be accessed and defined using the GUI. ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://ibm-cloud-architecture.github.io/refarch-eda/technology/event-streams/schema-registry-cp4i-v10#gui"}),"This section in the schema registry")," lab goes into the details on how to get the external URL and Scram password. "),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"If not done before download the pem file using the following CLI commands:"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"cloudctl login -a https://cp-console.apps.eda-solutions.gse-ocp.net --skip-ssl-validation\ncloudctl es init\ncloudctl es certificates --format pem\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Get userid, password and information of one of the kafka user defined. The namespace used below is the one where event streams is installed."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),'oc get kafkausers--namespace integration\noc get kafkauser my-user1 --namespace integration -o jsonpath=\'{"username: "}{.status.username}{"\\nsecret-name: "}{.status.secret}{"\\n"}\'\n'))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Set the following environment variables:"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"export KAFKA_BROKERS=es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443\nexport KAFKA_USER=my-user1\nexport KAFKA_PWD=$(oc get secret $KAFKA_USER --namespace integration -o jsonpath='{.data.password}' | base64 --decode)\nexport KAFKA_CERT=/home/es-cert.pem\n")),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"cd mirror-maker-2\n# Execute the script using docker\ndocker run -ti -v $(pwd):/home --rm -e  KAFKA_BROKERS=$KAFKA_SOURCE_BROKERS -e KAFKA_USER=$KAFKA_USER -e KAFKA_PWD=$KAFKA_PWD -e KAFKA_CERT=$KAFKA_CERT ibmcase/kcontainer-python:itgtests python /home/SendProductToKafka.py --file /home/data/products.json\n")))),Object(c.b)("h2",null,"Start Consumer from target cluster"),Object(c.b)("p",null,"Specifying the target cluster as Event Streams on cloud, we can also use Kafdrop to see the replicated topic."),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{}),"./scripts/startKafdrop.sh es-cloud.properties\n")))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-scenarios-kafka-mm-2-lab-2-index-mdx-49fc12a44b74c4b6dc53.js.map